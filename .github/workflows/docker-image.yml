name: Docker Image CI

on:
  push:
    branches:
      - master

jobs:
  push:
    runs-on: ubuntu-latest
    env:
      IMAGE_NAME: docker-theia-php

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Build image
        run: docker build . --file Dockerfile --tag image

      - name: Log into registries
        run: |
          # Login to Dockerhub.
          echo "${{ secrets.DOCKER_PASSWORD }}" | docker login docker.io -u verbral --password-stdin
          # Login to Github.
          echo "${{ secrets.GITHUB_TOKEN }}" | docker login docker.pkg.github.com -u verbruggenalex --password-stdin


      - name: Push image to registries
        run: |
          # Push to Dockerhub.
          docker tag image docker.io/verbral/docker-theia-php:latest
          docker push docker.io/verbral/docker-theia-php:latest
          # Push to Github.
          docker tag image docker.pkg.github.com/verbruggenalex/docker-theia-php/docker-theia-php:latest
          docker push docker.pkg.github.com/verbruggenalex/docker-theia-php/docker-theia-php:latest
